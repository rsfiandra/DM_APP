<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>N6 Hub v2 — Tabs, Weather, Notes, Tasks</title>
<style>
  :root{
    --bg:#050914;
    --panel:#101a2f;
    --card:#14213b;
    --muted:#9fb4d8;
    --text:#f4f7ff;
    --brand1:#8b5cf6;
    --brand2:#38bdf8;
    --brand3:#22d3ee;
    --ring:#1f2c46;
    --ok:#16a34a; --warn:#d97706; --bad:#ef4444;
    --shadow: 0 24px 60px rgba(5,9,20,.55);
    --grad: linear-gradient(135deg,var(--brand1),var(--brand3));
  }
  html.light {
    --bg:#f7f9ff;
    --panel:#ffffff;
    --card:#f1f4ff;
    --muted:#5b6478;
    --text:#0b1020;
    --ring:#d6ddf1;
    --shadow: 0 20px 45px rgba(15,23,42,.12);
  }
  * { box-sizing: border-box; }
  body {
    margin:0;
    background:
      radial-gradient(1200px 800px at -10% -20%, color-mix(in srgb, var(--brand2) 26%, transparent) 0, transparent 70%),
      radial-gradient(900px 600px at 110% -10%, color-mix(in srgb, var(--brand1) 22%, transparent) 0, transparent 65%),
      linear-gradient(180deg, color-mix(in srgb, var(--bg) 86%, #01030a 14%), color-mix(in srgb, var(--bg) 92%, #030615 8%));
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color: var(--text);
  }
  .app {
    min-height: 100vh; display:flex; flex-direction:column; gap:16px;
    padding: 18px;
  }
  header {
    display:flex; align-items:center; gap:12px; padding:12px 16px;
    background: linear-gradient(120deg,
      color-mix(in srgb, var(--panel) 70%, var(--brand1) 30%),
      color-mix(in srgb, var(--panel) 70%, var(--brand3) 30%));
    border:1px solid color-mix(in srgb, var(--ring) 70%, transparent);
    border-radius:18px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(8px);
  }
  .logo{
    background: var(--grad);
    color:#050914;
    font-weight:800;
    padding:10px 16px;
    border-radius:14px;
    letter-spacing:.6px;
    box-shadow: 0 10px 20px rgba(34,211,238,.25);
  }
  .grow{ flex:1 }
  .btn{
    appearance:none;
    border:1px solid color-mix(in srgb, var(--ring) 70%, transparent);
    color:var(--text);
    background: color-mix(in srgb, var(--panel) 82%, var(--brand2) 18%);
    border-radius:12px;
    padding:9px 12px;
    cursor:pointer;
    font-size:14px;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .btn:hover{
    transform: translateY(-1px);
    box-shadow: 0 8px 18px rgba(34,211,238,.22);
    background: color-mix(in srgb, var(--panel) 70%, var(--brand2) 30%);
  }
  .btn:focus-visible{
    outline:2px solid var(--brand2);
    outline-offset:2px;
  }
  .btn.brand{
    background: var(--grad);
    border-color: transparent;
    color:#050914;
    font-weight:600;
    box-shadow: 0 10px 22px rgba(139,92,246,.32);
  }
  .btn.brand:hover{
    box-shadow: 0 14px 26px rgba(139,92,246,.4);
  }
  .btn.ghost{
    background: color-mix(in srgb, var(--panel) 90%, transparent 10%);
  }
  .tabs{
    display:flex; gap:8px; flex-wrap:wrap;
    background: color-mix(in srgb, var(--panel) 92%, var(--bg) 8%);
    border:1px solid color-mix(in srgb, var(--ring) 60%, transparent);
    border-radius:16px;
    padding:12px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(6px);
  }
  .chip{
    padding:8px 14px;
    border-radius:999px;
    border:1px solid color-mix(in srgb, var(--ring) 65%, transparent);
    cursor:pointer;
    font-weight:600;
    font-size:14px;
    background: color-mix(in srgb, var(--panel) 78%, var(--brand3) 22%);
    color: color-mix(in srgb, var(--text) 86%, #ffffff 14%);
    opacity:.85;
    transition: background .2s ease, transform .2s ease, box-shadow .2s ease;
  }
  .chip:hover{
    transform: translateY(-1px);
    box-shadow: 0 6px 18px rgba(34,211,238,.2);
  }
  .chip.active{
    background: var(--grad);
    border-color: transparent;
    opacity:1;
    color:#050914;
    box-shadow: 0 10px 24px rgba(139,92,246,.35);
  }
  .page{
    background: color-mix(in srgb, var(--panel) 95%, var(--bg) 5%);
    border:1px solid color-mix(in srgb, var(--ring) 65%, transparent);
    border-radius:20px;
    padding:18px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(6px);
  }
  .grid{
    position:relative;
    display:grid;
    gap:16px;
    grid-template-columns: repeat(12, 1fr);
    background-image: none;
    background-size: 24px 24px;
  }
  .grid.editing{
    background-image: radial-gradient(circle at 1px 1px,
      color-mix(in srgb, var(--brand2) 55%, transparent) 0,
      color-mix(in srgb, var(--brand2) 55%, transparent) 2px,
      transparent 0);
  }
  .card{
    grid-column: span 6; min-height: 380px;
    background: color-mix(in srgb, var(--card) 92%, #000 8%);
    border:1px solid color-mix(in srgb, var(--ring) 65%, transparent);
    border-radius:16px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    box-shadow: 0 18px 36px rgba(5,9,20,.45);
  }
  @media (max-width: 1200px){ .card{ grid-column: span 12; } }
  .card-h{
    padding:12px 14px;
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    background: linear-gradient(135deg,
      color-mix(in srgb, var(--card) 60%, var(--brand2) 40%),
      color-mix(in srgb, var(--card) 60%, var(--brand1) 40%));
    color:#fdfdff;
    font-weight:600;
  }
  .h-actions{ display:flex; gap:6px; align-items:center; }
  .card-b{
    position:relative;
    flex:1;
    background: color-mix(in srgb, var(--card) 85%, var(--bg) 15%);
    overflow:auto;
  }
  .card-b iframe{ transition: opacity .25s ease; }
  .card-b.loading iframe{ opacity:0; }
  .card-b .skeleton{
    position:absolute;
    inset:0;
    border-radius:12px;
    background:
      linear-gradient(90deg,
        color-mix(in srgb, #ffffff 18%, transparent) 25%,
        color-mix(in srgb, #ffffff 32%, transparent) 37%,
        color-mix(in srgb, #ffffff 18%, transparent) 63%);
    background-size: 200% 100%;
    animation: skeleton-sheen 1.4s ease infinite;
    opacity:0;
    pointer-events:none;
    z-index:2;
  }
  .card-b.loading .skeleton{ opacity:1; }
  .card-b.error .skeleton{ opacity:0; }
  @keyframes skeleton-sheen{
    0%{ background-position: 200% 0; }
    100%{ background-position: -200% 0; }
  }
  iframe{
    width:100%;
    height:100%;
    border:0;
    background: color-mix(in srgb, var(--card) 80%, var(--bg) 20%);
  }
  .badge{
    position:absolute;
    top:10px;
    left:10px;
    background: color-mix(in srgb, var(--brand1) 35%, #000 65%);
    color:#f8fbff;
    font-size:12px;
    padding:4px 9px;
    border-radius:999px;
    backdrop-filter: blur(6px);
    border:1px solid color-mix(in srgb, var(--brand3) 40%, transparent);
    z-index:3;
  }
  .hint{
    position:absolute;
    inset:auto 12px 12px 12px;
    padding:12px;
    border-radius:14px;
    background: color-mix(in srgb, var(--panel) 80%, #000 20%);
    color:#fdfdff;
    font-size:12px;
    line-height:1.4;
    border:1px solid color-mix(in srgb, var(--ring) 60%, transparent);
    box-shadow: 0 14px 30px rgba(5,9,20,.55);
    display:none;
    z-index:4;
  }
  .card-b.error .hint{ display:block }
  dialog{
    width:min(1000px, 96vw);
    border:1px solid color-mix(in srgb, var(--ring) 65%, transparent);
    border-radius:18px;
    padding:0;
    background: color-mix(in srgb, var(--panel) 94%, var(--bg) 6%);
    color:var(--text);
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
  }
  dialog::backdrop{
    background:rgba(4,6,15,.55);
    backdrop-filter: blur(4px);
  }
  .dlg-h{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px 18px;
    background: var(--grad);
    color:#050914;
    font-weight:700;
  }
  .dlg-b{ padding:16px 18px; }
  table{ width:100%; border-collapse: collapse; font-size:14px; }
  th, td{ border-bottom:1px solid var(--ring); padding:8px; text-align:left; }
  tbody tr:hover{ background: color-mix(in srgb, var(--panel) 80%, var(--brand3) 12%); }
  input[type="text"], input[type="number"]{
    width:100%;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid color-mix(in srgb, var(--ring) 60%, transparent);
    background: color-mix(in srgb, var(--panel) 85%, var(--brand3) 15%);
    color:var(--text);
  }
  .row-actions{ display:flex; gap:6px }
  .toolbar{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px }
  .subtle{ color:var(--muted); font-size:12px }
  .pill{
    padding:6px 12px;
    border-radius:999px;
    border:1px solid color-mix(in srgb, var(--ring) 60%, transparent);
    background: color-mix(in srgb, var(--panel) 82%, var(--brand1) 18%);
    box-shadow: 0 8px 18px rgba(139,92,246,.28);
  }
  .footer{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px }
  .tog{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid color-mix(in srgb, var(--ring) 60%, transparent);
    cursor:pointer;
    background: color-mix(in srgb, var(--panel) 88%, var(--brand2) 12%);
  }
  .resizer{
    height:6px;
    cursor:ns-resize;
    background: linear-gradient(90deg,
      color-mix(in srgb, var(--brand1) 45%, var(--panel) 55%),
      color-mix(in srgb, var(--brand2) 45%, var(--panel) 55%));
  }
  .notes-area{
    width:100%;
    height:100%;
    padding:14px;
    color:var(--text);
    outline:none;
    background: color-mix(in srgb, var(--card) 75%, var(--brand2) 25%);
    background-blend-mode: screen;
    border-radius:10px;
    border:1px solid color-mix(in srgb, var(--ring) 55%, transparent);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
    resize:none;
    overflow:auto;
  }

  /* Override notes background in light mode so dark text remains legible */
  html.light .notes-area{
    background: color-mix(in srgb, var(--panel) 92%, var(--brand2) 8%);
    color: var(--text);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.4);
  }

  /* ======= Grid Table styling (Excel-like) ======= */
  .grid-table{
    border-collapse: collapse;
    width: 100%;
    table-layout: fixed;
  }
  .grid-table th,
  .grid-table td{
    border: 1px solid var(--ring);
    padding: 6px 8px;
    min-width: 80px;
    white-space: nowrap;
  }
  .grid-table th{
    background: linear-gradient(90deg,
      color-mix(in srgb, var(--brand1) 15%, var(--panel) 85%),
      color-mix(in srgb, var(--brand2) 15%, var(--panel) 85%)
    );
    cursor: pointer;
    user-select: none;
    color: var(--text);
  }
  .grid-table td:focus{
    outline: 2px solid var(--brand2);
    outline-offset: -2px;
  }
  /* Alternate row shading */
  .grid-table tbody tr:nth-child(even) td{
    background: color-mix(in srgb, var(--panel) 92%, var(--bg) 8%);
  }

  /* More compact headers for embedded cards (not for Weather/Notes/Tasks) */
  .card-h.embed{
    /* Reduce padding to make headers more dense */
    padding:4px 6px;
    font-size:12px;
  }
  .card-h.embed .btn{
    /* Smaller buttons and fonts for embed headers */
    padding:2px 6px;
    font-size:11px;
    border-radius:6px;
  }

  /* Horizontal resizer for adjusting card width (grid span). Placed at the right edge of embed cards. */
  .resizer-x {
    width: 6px;
    cursor: ew-resize;
    /* Use a vertical gradient to complement the vertical resizer */
    background: linear-gradient(180deg,
      color-mix(in srgb, var(--brand1) 40%, var(--panel) 60%),
      color-mix(in srgb, var(--brand2) 40%, var(--panel) 60%)
    );
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
  }

  .resizer,
  .resizer-x{
    display:none;
  }
  .grid.editing .resizer,
  .grid.editing .resizer-x{
    display:block;
  }

  /* ===== Styles for Links page ===== */
  /* Grid container for cards in card view */
  .links-grid {
    /* Responsive grid for a small card gallery: cards auto-wrap with a minimum width
       of 140px so more cards fit per row. */
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    /* Align items to the start so that cards don't stretch to fill entire row */
    justify-content: flex-start;
    justify-items: start;
  }
  /* Individual link card styled like the bingo game: small, colorful, and neat */
  .link-card {
    /* Use a stronger gradient mix to recall the bingo design and scale down size */
    background: linear-gradient(135deg,
      color-mix(in srgb, var(--brand1) 60%, var(--panel) 40%),
      color-mix(in srgb, var(--brand2) 60%, var(--panel) 40%)
    );
    color: var(--text);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    min-height: 100px;
    /* A softer shadow than full cards, to give a floating tile effect */
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    position: relative;
    /* Smooth transitions for hover effects */
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
    /* Constrain the width of individual cards so they resemble small bingo tiles */
    max-width: 200px;
    width: 100%;
  }
  /* Hover effects for link cards: pop up slightly, brighten gradient, and stronger shadow */
  .link-card:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    background: linear-gradient(135deg,
      color-mix(in srgb, var(--brand1) 70%, var(--panel) 30%),
      color-mix(in srgb, var(--brand2) 70%, var(--panel) 30%)
    );
  }

  /* Delete button overlay for link cards, hidden by default */
  .small-del-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 20px;
    height: 20px;
    border: none;
    border-radius: 50%;
    background: rgba(0,0,0,0.5);
    color: #fff;
    font-size: 14px;
    line-height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .link-card:hover .small-del-btn {
    opacity: 1;
  }
  .link-card-title {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 4px;
    color: var(--text);
    line-height: 1.2;
    /* Center the title in the small card */
    text-align: left;
  }
  .link-card-url {
    font-size: 11px;
    color: var(--muted);
    word-break: break-all;
    margin-bottom: 6px;
    line-height: 1.3;
  }
  .link-card-actions {
    margin-top: auto;
    display: flex;
    gap: 4px;
  }
  .link-card-actions .btn {
    font-size: 11px;
    padding: 2px 5px;
    border-radius: 6px;
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">N6 HUB</div>
    <div class="grow"></div>
    <button class="btn" id="btn-setup">Setup</button>
    <button class="btn ghost" id="btn-layout" aria-pressed="false">Edit layout</button>
    <button class="btn ghost" id="btn-export">Export</button>
    <button class="btn ghost" id="btn-import">Import</button>
    <label class="tog" title="Toggle light/dark">
      <input type="checkbox" id="mode" />
      <span>Light mode</span>
    </label>
  </header>

  <div class="tabs" id="tabbar"></div>

  <section class="page">
    <div class="grid" id="cards"></div>
  </section>

  <div class="subtle">Tip: some sites block embedding (X-Frame-Options / CSP). If a card shows a hint, click “Open” to view in a new tab. Drag the handle at the bottom of a card to resize its height.</div>
  <div class="footer">
    <div class="pill" id="status">Ready</div>
    <div class="subtle">Data stored in localStorage under <code>n6hub:config:v2</code></div>
  </div>
</div>

<dialog id="dlg">
  <div class="dlg-h">
    <div>Setup: Embedded Pages</div>
    <button class="btn" id="closeDlg">Close</button>
  </div>
  <div class="dlg-b">
    <div class="toolbar">
      <button class="btn brand" id="addRow">Add Row</button>
      <button class="btn" id="seed">Seed Examples</button>
      <div class="subtle">Columns: <b>Page</b> (tab name), <b>Title</b> (card title), <b>Height</b> (px), <b>URL</b> (embed src)</div>
    </div>
    <div style="overflow:auto; max-height: 55vh; border:1px solid var(--ring); border-radius:12px;">
      <table id="tbl">
        <thead>
          <tr>
            <th style="width:160px">Page</th>
            <th style="width:220px">Title</th>
            <th style="width:120px">Height (px)</th>
            <th>URL</th>
            <th style="width:190px">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="save">Save</button>
      <span class="subtle">Changes auto-save on field edit too.</span>
    </div>
  </div>
</dialog>

<script>
const LS_KEY = "n6hub:config:v2";
const LAST_PAGE_KEY = "n6hub:lastPage";
const NOTES_KEY = "n6hub:notes";
const HINT_DELAY = 1200;
const DEFAULTS = [
  { page:"BI",      title:"ServiceNow",    url:"https://app.powerbi.com/reportEmbed?reportId=e1e7ca50-bdb4-4d95-a482-bfe8e1479cef&autoAuth=true&ctid=c0a17cb1-4afe-40d4-9ed4-3bacc6d472e5", height:380 },
  { page:"BI",      title:"InMoment Tags", url:"https://app.powerbi.com/reportEmbed?reportId=9c9e03df-cf99-4d67-863b-4aabcf56adf8&autoAuth=true&ctid=c0a17cb1-4afe-40d4-9ed4-3bacc6d472e5", height:380 },
  { page:"BI",      title:"Test 1",        url:"https://app.powerbi.com/reportEmbed?reportId=4b95a956-269f-4c3c-bcd3-535c20921584&autoAuth=true&ctid=c0a17cb1-4afe-40d4-9ed4-3bacc6d472e5", height:380 },
  { page:"Browse",  title:"Wikipedia",     url:"https://en.wikipedia.org/wiki/Main_Page", height:380 },
  { page:"Browse",  title:"DuckDuckGo Lite", url:"https://lite.duckduckgo.com/lite/", height:380 },
  { page:"Maps",    title:"OpenStreetMap NYC", url:"https://www.openstreetmap.org/export/embed.html?bbox=-74.0267,40.6839,-73.9106,40.8776&layer=mapnik", height:380 },
  { page:"Docs",    title:"MDN",           url:"https://developer.mozilla.org", height:380 },
  { page:"Weather", title:"Regional Weather", type:"weather", height:600 },
  { page:"Notes",   title:"Notes",         type:"notes", height:500 },
  { page:"Tasks",   title:"Tasks",         type:"tasks", height:500 }
  ,{ page:"Table",  title:"Table",        type:"table", height:500, data:[] }
  ,{ page:"Links",  title:"Links",        type:"links", height:500, links: [], viewMode:'list' }
];
function loadConfig(){
  try{ return JSON.parse(localStorage.getItem(LS_KEY)) || DEFAULTS.slice(); }
  catch{ return DEFAULTS.slice(); }
}
function saveConfig(rows){ localStorage.setItem(LS_KEY, JSON.stringify(rows)); }
function uniquePages(rows){ return [...new Set(rows.map(r => (r.page||"").trim()).filter(Boolean))]; }
// Element factory helper: assigns className, style, and data/aria attributes correctly
function el(tag, props={}, ...kids){
  const e = document.createElement(tag);
  for(const key of Object.keys(props)){
    const value = props[key];
    if(key === 'className'){
      e.className = value;
    } else if(key === 'style'){
      e.setAttribute('style', value);
    } else if(key.includes('-')){
      // Attributes with hyphens (e.g. data-*, aria-*) should be set via setAttribute
      e.setAttribute(key, value);
    } else {
      e[key] = value;
    }
  }
  for(const child of kids){
    e.append(child);
  }
  return e;
}
function debounce(fn, wait=300){
  let timeout;
  let lastArgs;
  let lastThis;
  function invoke(){
    const args = lastArgs;
    const ctx = lastThis;
    timeout = null;
    lastArgs = undefined;
    lastThis = undefined;
    fn.apply(ctx, args);
  }
  function debounced(...args){
    lastArgs = args;
    lastThis = this;
    if(timeout){ clearTimeout(timeout); }
    timeout = setTimeout(invoke, wait);
  }
  debounced.flush = () => {
    if(timeout){
      clearTimeout(timeout);
      invoke();
    }
  };
  debounced.cancel = () => {
    if(timeout){
      clearTimeout(timeout);
    }
    timeout = null;
    lastArgs = undefined;
    lastThis = undefined;
  };
  return debounced;
}
function setStatus(msg){ document.getElementById("status").textContent = msg; }
let rows = loadConfig();

// Ensure a table page exists in the config. If not found, add a default blank table.
if(!rows.some(r => r.page === 'Table')){
  rows.push({ page:'Table', title:'Table', type:'table', height:500, data: Array.from({length: 10}, () => Array.from({length: 5}, () => '')) });
  saveConfig(rows);
}

// Ensure a links page exists in the config. If not found, add a default links page.
if(!rows.some(r => r.page === 'Links')){
  rows.push({ page:'Links', title:'Links', type:'links', height:500, links: [], viewMode:'list' });
  saveConfig(rows);
}
const tabbar = document.getElementById("tabbar");
const cards = document.getElementById("cards");
const layoutToggle = document.getElementById("btn-layout");
const queueConfigSave = debounce(() => saveConfig(rows), 300);
const saveNotesDebounced = debounce(value => localStorage.setItem(NOTES_KEY, value), 300);
let layoutEditing = false;
let skipHashUpdate = false;
function getPageFromHash(){
  const raw = window.location.hash;
  if(!raw) return '';
  try{ return decodeURIComponent(raw.slice(1)); }
  catch{ return raw.slice(1); }
}
function updateHashForPage(page){
  if(!page) return;
  const encoded = '#' + encodeURIComponent(page);
  if(window.location.hash === encoded) return;
  history.replaceState(null, '', encoded);
}
function rememberCurrentPage(){
  if(!currentPage) return;
  if(currentPage === 'Setup') return;
  localStorage.setItem(LAST_PAGE_KEY, currentPage);
  if(skipHashUpdate) return;
  updateHashForPage(currentPage);
}
function determineInitialPage(){
  const pages = uniquePages(rows);
  if(pages.length === 0) return 'Setup';
  const hashPage = getPageFromHash();
  if(hashPage && pages.includes(hashPage)) return hashPage;
  const stored = localStorage.getItem(LAST_PAGE_KEY);
  if(stored && pages.includes(stored)) return stored;
  return pages[0];
}
let currentPage = determineInitialPage();
function updateLayoutToggleUI(){
  if(!layoutToggle) return;
  layoutToggle.textContent = layoutEditing ? 'Lock layout' : 'Edit layout';
  layoutToggle.classList.toggle('brand', layoutEditing);
  layoutToggle.setAttribute('aria-pressed', layoutEditing);
  cards.classList.toggle('editing', layoutEditing);
}
if(layoutToggle){
  layoutToggle.addEventListener('click', () => {
    layoutEditing = !layoutEditing;
    updateLayoutToggleUI();
    setStatus(layoutEditing ? 'Layout editing enabled. Drag handles to resize cards.' : 'Layout locked.');
  });
  updateLayoutToggleUI();
}
function renderTabs(){
  tabbar.innerHTML = "";
  const pages = uniquePages(rows);
  if(pages.length===0) pages.push("Setup");
  for(const p of pages){
    const isActive = p === currentPage;
    const b = el("button", {className:"chip" + (isActive?" active":""), type:"button", 'data-page':p});
    if(isActive) b.setAttribute('aria-current','page');
    b.textContent = p;
    b.onclick = () => setCurrentPage(p);
    tabbar.appendChild(b);
  }
}
function setCurrentPage(page, opts={}){
  const { fromHash = false } = opts;
  const pages = uniquePages(rows);
  if(!pages.includes(page)) return;
  const prevSkip = skipHashUpdate;
  skipHashUpdate = fromHash;
  if(page === currentPage){
    rememberCurrentPage();
    skipHashUpdate = prevSkip;
    return;
  }
  currentPage = page;
  renderTabs();
  renderCards();
  skipHashUpdate = prevSkip;
}
function createResizer(card, rec){
  const resize = el('div',{className:'resizer'});
  resize.onpointerdown = (e) => {
    if(!layoutEditing) return;
    e.preventDefault();
    const startY = e.clientY;
    const startH = parseFloat(card.style.minHeight) || card.offsetHeight;
    function move(ev){
      const dy = ev.clientY - startY;
      let newH = startH + dy;
      if(newH < 100) newH = 100;
      card.style.minHeight = newH + 'px';
    }
    function up(ev){
      const dy = ev.clientY - startY;
      let newH = startH + dy;
      if(newH < 100) newH = 100;
      rec.height = Math.round(newH);
      saveConfig(rows);
      document.removeEventListener('pointermove', move);
      document.removeEventListener('pointerup', up);
    }
    document.addEventListener('pointermove', move);
    document.addEventListener('pointerup', up);
  };
  return resize;
}

// Create a horizontal resizer to adjust card width (grid span). This allows users to drag the right edge
// of an embed card and change how many grid columns it spans. The `isSingle` flag indicates
// whether only one embed card is present on the page, in which case the default span is 12.
function createWidthResizer(card, rec, isSingle){
  const resize = el('div',{className:'resizer-x'});
  resize.onpointerdown = (e) => {
    if(!layoutEditing) return;
    e.preventDefault();
    const startX = e.clientX;
    let startSpan = rec.span || (isSingle ? 12 : 6);
    const container = cards;
    const style = window.getComputedStyle(container);
    const gapVal = parseFloat(style.gap) || 0;
    const containerWidth = container.clientWidth;
    const colWidth = (containerWidth - gapVal * 11) / 12;
    function move(ev){
      const dx = ev.clientX - startX;
      let delta = Math.round(dx / (colWidth + gapVal));
      let newSpan = startSpan + delta;
      if(newSpan < 1) newSpan = 1;
      if(newSpan > 12) newSpan = 12;
      rec.span = newSpan;
      card.style.gridColumn = 'span ' + newSpan;
    }
    function up(){
      saveConfig(rows);
      document.removeEventListener('pointermove', move);
      document.removeEventListener('pointerup', up);
    }
    document.addEventListener('pointermove', move);
    document.addEventListener('pointerup', up);
  };
  return resize;
}
function renderWeatherPage(rec){ cards.innerHTML = ""; const card = el('div',{className:'card', style:'grid-column:span 12;min-height:'+(rec.height || 600)+'px'}); const h = el('div',{className:'card-h'}, rec.title || 'Weather'); const body = el('div',{className:'card-b'}, el('div',{className:'tomorrow', 'data-location-id':'111783,128587,114900,122795,111151,124126','data-language':'EN','data-unit-system':'IMPERIAL','data-skin':'light','data-widget-type':'current6', style:'padding-bottom:22px;position:relative;'}, el('a',{href:'https://weather.tomorrow.io/', rel:'nofollow noopener noreferrer', target:'_blank', style:'position:absolute;bottom:0;transform:translateX(-50%);left:50%;'}, el('img',{alt:'Powered by Tomorrow.io', src:'https://weather-website-client.tomorrow.io/img/powered-by.svg', width:'250', height:'18'}))), el('div',{className:'tomorrow','data-location-id':'111783','data-language':'EN','data-unit-system':'IMPERIAL','data-skin':'light','data-widget-type':'upcoming', style:'padding-bottom:22px;position:relative;'}, el('a',{href:'https://weather.tomorrow.io/', rel:'nofollow noopener noreferrer', target:'_blank', style:'position:absolute;bottom:0;transform:translateX(-50%);left:50%;'}, el('img',{alt:'Powered by Tomorrow.io', src:'https://weather-website-client.tomorrow.io/img/powered-by.svg', width:'250', height:'18'})))); card.append(h, body); cards.append(card); if(window.__TOMORROW__){ window.__TOMORROW__.renderWidget(); } }
function renderNotesPage(rec){
  cards.innerHTML = "";
  const card = el('div',{className:'card', style:'grid-column:span 12;min-height:'+(rec.height || 500)+'px'});
  const h = el('div',{className:'card-h'}, rec.title || 'Notes');
  const body = el('div',{className:'card-b'});
  const notesArea = el('div',{className:'notes-area', contentEditable:'true'});
  notesArea.innerText = localStorage.getItem(NOTES_KEY) || '';
  notesArea.addEventListener('input', () => {
    saveNotesDebounced(notesArea.innerText);
  });
  body.append(notesArea);
  card.append(h, body);
  cards.append(card);
}
function renderTasksPage(rec){ cards.innerHTML = ""; const card = el('div',{className:'card', style:'grid-column:span 12;min-height:'+(rec.height || 500)+'px'}); const h = el('div',{className:'card-h'}, rec.title || 'Tasks'); const body = el('div',{className:'card-b'}, el('div',{className:'hint', style:'display:block'}, 'Task list is empty. Add tasks via upcoming setup.')); card.append(h, body); cards.append(card); }

// Render a spreadsheet-like table with arrow-key navigation and sortable columns
function renderTablePage(rec){
  cards.innerHTML = "";
  // Ensure data matrix exists; default to 10x5 grid
  if(!Array.isArray(rec.data) || rec.data.length === 0){
    rec.data = Array.from({length: 10}, () => Array.from({length: 5}, () => ""));
  }
  const numRows = rec.data.length;
  const numCols = rec.data[0] ? rec.data[0].length : 0;
  // Create table elements
  const table = document.createElement('table');
  table.className = 'grid-table';
  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  // Sorting functionality
  function sortTableByColumn(col){
    // Toggle sort direction if previously sorted on same column
    const dir = (rec.sortColumn === col && rec.sortDirection === 'asc') ? 'desc' : 'asc';
    rec.sortColumn = col;
    rec.sortDirection = dir;
    rec.data.sort((a,b) => {
      const valA = (a[col] || '').toLowerCase();
      const valB = (b[col] || '').toLowerCase();
      if(valA < valB) return dir === 'asc' ? -1 : 1;
      if(valA > valB) return dir === 'asc' ? 1 : -1;
      return 0;
    });
    saveConfig(rows);
    // Re-render table after sorting
    renderTablePage(rec);
  }
  // Build header cells
  for(let c=0; c<numCols; c++){
    const th = document.createElement('th');
    th.textContent = 'Col ' + (c+1);
    th.onclick = () => sortTableByColumn(c);
    headerRow.appendChild(th);
  }
  thead.appendChild(headerRow);
  table.appendChild(thead);
  // Build body
  const tbody = document.createElement('tbody');
  for(let r=0; r<numRows; r++){
    const tr = document.createElement('tr');
    for(let c=0; c<numCols; c++){
      const td = document.createElement('td');
      td.contentEditable = true;
      td.tabIndex = 0;
      td.dataset.row = r;
      td.dataset.col = c;
      td.innerText = rec.data[r][c] || '';
      // Save value on input
      td.oninput = () => {
        rec.data[r][c] = td.innerText;
        queueConfigSave();
      };
      // Arrow key navigation
      td.onkeydown = (e) => {
        const row = parseInt(td.dataset.row);
        const col = parseInt(td.dataset.col);
        let target;
        switch(e.key){
          case 'ArrowUp':
            if(row > 0){
              e.preventDefault();
              target = tbody.querySelector('[data-row="'+(row-1)+'"][data-col="'+col+'"]');
              if(target) target.focus();
            }
            break;
          case 'ArrowDown':
            if(row < numRows - 1){
              e.preventDefault();
              target = tbody.querySelector('[data-row="'+(row+1)+'"][data-col="'+col+'"]');
              if(target) target.focus();
            }
            break;
          case 'ArrowLeft':
            if(col > 0){
              e.preventDefault();
              target = tbody.querySelector('[data-row="'+row+'"][data-col="'+(col-1)+'"]');
              if(target) target.focus();
            }
            break;
          case 'ArrowRight':
            if(col < numCols - 1){
              e.preventDefault();
              target = tbody.querySelector('[data-row="'+row+'"][data-col="'+(col+1)+'"]');
              if(target) target.focus();
            }
            break;
        }
      };
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
  table.appendChild(tbody);
  // Build card with table
  const card = el('div',{className:'card', style:'grid-column:span 12;min-height:'+(rec.height || 500)+'px'});
  const h = el('div',{className:'card-h'}, rec.title || 'Table');
  const body = el('div',{className:'card-b'}, table);
  card.append(h, body);
  cards.append(card);
}

// Render a Links page which can toggle between list (table) view and card view.
// The `rec.links` array holds objects with `name` and `url` properties. A `viewMode` property
// on the record determines whether to display as 'list' or 'cards'. Users can add, edit, delete
// links, and open them in a new tab. State persists in localStorage via saveConfig(rows).
function renderLinksPage(rec){
  // Clear cards container
  cards.innerHTML = "";
  // Ensure links array exists and viewMode is defined
  if(!Array.isArray(rec.links)) rec.links = [];
  if(!rec.viewMode) rec.viewMode = 'list';
  const card = el('div',{className:'card', style:'grid-column:span 12;min-height:'+(rec.height || 500)+'px'});
  // Toggle button between list and card view
  const toggleBtn = el('button',{className:'btn', onclick:() => {
    rec.viewMode = rec.viewMode === 'list' ? 'cards' : 'list';
    saveConfig(rows);
    renderLinksPage(rec);
  }}, rec.viewMode === 'list' ? 'Card view' : 'List view');
  // Add new link button
  const addBtn = el('button',{className:'btn', onclick:() => {
    rec.links.push({ name:'', url:'' });
    saveConfig(rows);
    renderLinksPage(rec);
  }}, 'Add');
  const hActions = el('div',{className:'h-actions'}, toggleBtn, addBtn);
  const h = el('div',{className:'card-h'}, rec.title || 'Links', hActions);
  const body = el('div',{className:'card-b'});
  if(rec.viewMode === 'list'){
    // Build table for list view
    const table = document.createElement('table');
    table.className = 'grid-table';
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    const thName = document.createElement('th'); thName.textContent = 'Name';
    const thUrl = document.createElement('th'); thUrl.textContent = 'URL';
    const thActions = document.createElement('th'); thActions.textContent = 'Actions';
    headerRow.append(thName, thUrl, thActions);
    thead.append(headerRow);
    table.append(thead);
    const tbodyEl = document.createElement('tbody');
    rec.links.forEach((lnk, i) => {
      const tr = document.createElement('tr');
      const tdName = document.createElement('td');
      const inpName = document.createElement('input');
      inpName.type = 'text';
      inpName.value = lnk.name || '';
      inpName.oninput = e => {
        rec.links[i].name = e.target.value;
        saveConfig(rows);
      };
      tdName.append(inpName);
      const tdUrl = document.createElement('td');
      const inpUrl = document.createElement('input');
      inpUrl.type = 'text';
      inpUrl.value = lnk.url || '';
      inpUrl.oninput = e => {
        rec.links[i].url = e.target.value;
        saveConfig(rows);
      };
      tdUrl.append(inpUrl);
      const tdAct = document.createElement('td');
      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'row-actions';
      const openBtn = el('button',{className:'btn', onclick:() => window.open(lnk.url, '_blank')}, 'Open');
      const delBtn = el('button',{className:'btn', onclick:() => {
        rec.links.splice(i, 1);
        saveConfig(rows);
        renderLinksPage(rec);
      }}, 'Delete');
      actionsDiv.append(openBtn, delBtn);
      tdAct.append(actionsDiv);
      tr.append(tdName, tdUrl, tdAct);
      tbodyEl.append(tr);
    });
    table.append(tbodyEl);
    body.append(table);
  } else {
    // Card view: show each link as a small card. The card opens the link when clicked
    // and displays only the title. A small delete button appears on hover to remove the link.
    const grid = el('div',{className:'links-grid'});
    rec.links.forEach((lnk, i) => {
      // Delete button overlay; stop propagation so clicking it doesn't open the link
      const delBtn = el('button',{className:'small-del-btn', title:'Delete', onclick:(e) => {
        e.stopPropagation();
        rec.links.splice(i, 1);
        saveConfig(rows);
        renderLinksPage(rec);
      }}, '×');
      const lCard = el('div',{className:'link-card', onclick:() => {
        // Only open if a URL is provided
        if(lnk.url) window.open(lnk.url, '_blank');
      }},
        delBtn,
        el('div',{className:'link-card-title'}, lnk.name || '(Untitled)')
      );
      grid.append(lCard);
    });
    body.append(grid);
  }
  card.append(h, body);
  cards.append(card);
  setStatus('Showing links.');
}
function cardHint(block, url){
  block.classList.add('error');
  block.classList.remove('loading');
  const hint = block.querySelector('.hint');
  if(hint){
    if(url){
      hint.innerHTML = `This site may block embedding (X-Frame-Options / CSP). <a href="${url}" target="_blank" style="color:#fff;text-decoration:underline">Open</a>`;
    }else{
      hint.textContent = 'This site may block embedding (X-Frame-Options / CSP).';
    }
  }
  block._hintTimer = null;
}
function renderCards(){
  cards.classList.toggle('editing', layoutEditing);
  rememberCurrentPage();
  if(currentPage === 'Weather'){
    const rec = rows.find(r => r.page === 'Weather');
    if(rec){
      renderWeatherPage(rec);
      setTimeout(() => {
        if(window.__TOMORROW__){ window.__TOMORROW__.renderWidget(); }
      }, 0);
      setStatus('Showing weather.');
      return;
    }
  }
  if(currentPage === 'Notes'){
    const rec = rows.find(r => r.page === 'Notes');
    if(rec){
      renderNotesPage(rec);
      setStatus('Showing notes.');
      return;
    }
  }
  if(currentPage === 'Tasks'){
    const rec = rows.find(r => r.page === 'Tasks');
    if(rec){
      renderTasksPage(rec);
      setStatus('Showing tasks.');
      return;
    }
  }
  if(currentPage === 'Table'){
    const rec = rows.find(r => r.page === 'Table');
    if(rec){
      renderTablePage(rec);
      setStatus('Showing table.');
      return;
    }
  }
  if(currentPage === 'Links'){
    const rec = rows.find(r => r.page === 'Links');
    if(rec){
      renderLinksPage(rec);
      return;
    }
  }
  cards.innerHTML = "";
  const list = rows.filter(r => (r.page||"").trim() === currentPage && !r.type);
  const isSingle = list.length === 1;
  if(list.length === 0){
    cards.append(
      el('div',{className:'card', style:'grid-column:span 12;min-height:140px'},
        el('div',{className:'card-h'},
          'No content for ‘'+currentPage+'’',
          el('div',{className:'h-actions'},
            el('button',{className:'btn', onclick: openSetup},'Open Setup')
          )
        ),
        el('div',{className:'card-b'},
          el('div',{className:'hint', style:'display:block'},'Use Setup to add rows for this page.')
        )
      )
    );
    return;
  }
  for(const rec of list){
    const card = el('div',{className:'card'});
    card.style.minHeight = (rec.height || 380) + 'px';
    card.style.position = 'relative';
    if(!rec.span){ rec.span = isSingle ? 12 : 6; }
    card.style.gridColumn = 'span ' + rec.span;
    const actions = el('div',{className:'h-actions'},
      el('button',{className:'btn', title:'Refresh', onclick: () => reloadIframe(card, rec)},'Refresh'),
      el('button',{className:'btn', title:'Open in new tab', onclick: () => { if(rec.url){ window.open(rec.url, '_blank'); }}},'Open')
    );
    if(!rec.type){
      actions.append(
        el('button',{className:'btn', title:'Zoom out', onclick: () => {
          rec.zoom = Math.max((rec.zoom || 1) - 0.1, 0.5);
          saveConfig(rows);
          renderCards();
        }},'−'),
        el('button',{className:'btn', title:'Zoom in', onclick: () => {
          rec.zoom = (rec.zoom || 1) + 0.1;
          saveConfig(rows);
          renderCards();
        }},'+')
      );
    }
    const h = el('div',{className:'card-h'},
      el('div',{}, rec.title || '(Untitled)'),
      actions
    );
    if(!rec.type){ h.classList.add('embed'); }
    const zoomVal = rec.zoom || 1;
    const iframeEl = el('iframe',{src: rec.url, referrerPolicy:'no-referrer', loading:'lazy'});
    iframeEl.style.transform = 'scale('+zoomVal+')';
    iframeEl.style.transformOrigin = '0 0';
    iframeEl.style.width = (100/zoomVal) + '%';
    iframeEl.style.height = (100/zoomVal) + '%';
    let badgeText = '';
    try{
      badgeText = new URL(rec.url).hostname;
    }catch{
      badgeText = (rec.url || '').replace(/^https?:\/\//,'').split('/')[0] || 'Preview';
    }
    const skeleton = el('div',{className:'skeleton','aria-hidden':'true'});
    const hint = el('div',{className:'hint'},'');
    const body = el('div',{className:'card-b loading'},
      skeleton,
      el('span',{className:'badge'}, badgeText),
      iframeEl,
      hint
    );
    card.append(
      h,
      body,
      createResizer(card, rec),
      createWidthResizer(card, rec, isSingle)
    );
    if(body._hintTimer){ clearTimeout(body._hintTimer); }
    body._hintTimer = setTimeout(() => cardHint(body, rec.url), HINT_DELAY);
    iframeEl.addEventListener('load', () => {
      if(body._hintTimer){
        clearTimeout(body._hintTimer);
        body._hintTimer = null;
      }
      body.classList.remove('error');
      body.classList.remove('loading');
      body.classList.add('loaded');
      const hintEl = body.querySelector('.hint');
      if(hintEl){
        hintEl.textContent = '';
      }
    });
    cards.append(card);
  }
  setStatus('Showing '+list.length+' item(s) on “'+currentPage+'”.');
}
function reloadIframe(card, rec){
  const iframe = card.querySelector('iframe');
  if(!iframe) return;
  const body = card.querySelector('.card-b');
  const targetUrl = (rec && rec.url) || iframe.getAttribute('src');
  if(body){
    body.classList.remove('error');
    body.classList.remove('loaded');
    body.classList.add('loading');
    const hintEl = body.querySelector('.hint');
    if(hintEl){ hintEl.textContent = ''; }
    if(body._hintTimer){
      clearTimeout(body._hintTimer);
    }
    body._hintTimer = setTimeout(() => cardHint(body, targetUrl), HINT_DELAY);
  }
  iframe.setAttribute('src', targetUrl);
}
const dlg = document.getElementById("dlg");
const tbody = document.getElementById("tbody");
function openSetup(){ dlg.showModal(); drawTable(); }
function closeSetup(){ dlg.close(); }
function drawTable(){ tbody.innerHTML = ""; rows.forEach((r, i) => { const tr = el("tr"); const tdPage  = el("td",{}, el("input",{type:"text", value: r.page || "", oninput: e => { rows[i].page = e.target.value; saveConfig(rows); renderTabs(); }})); const tdTitle = el("td",{}, el("input",{type:"text", value: r.title|| "", oninput: e => { rows[i].title = e.target.value; saveConfig(rows); }})); const tdHeight = el("td",{}, el("input",{type:"number", min:100, value: r.height || "", oninput: e => { rows[i].height = parseInt(e.target.value)||null; saveConfig(rows); }})); const tdUrl   = el("td",{}, el("input",{type:"text", value: r.url  || "", oninput: e => { rows[i].url   = e.target.value; saveConfig(rows); }})); const actions = el("td",{}, el("div",{className:"row-actions"}, el("button",{className:"btn", onclick:()=>moveRow(i,-1)}, "↑"), el("button",{className:"btn", onclick:()=>moveRow(i, 1)}, "↓"), el("button",{className:"btn", onclick:()=>duplicateRow(i)}, "Copy"), el("button",{className:"btn", onclick:()=>removeRow(i)}, "Delete") )); tr.append(tdPage, tdTitle, tdHeight, tdUrl, actions); tbody.append(tr); }); }
function addRow(){ rows.push({ page:"New", title:"New Card", url:"https://example.com", height:380 }); saveConfig(rows); drawTable(); renderTabs(); }
function moveRow(i, dir){ const j = i + dir; if(j<0 || j>=rows.length) return; const t = rows[i]; rows[i] = rows[j]; rows[j] = t; saveConfig(rows); drawTable(); renderTabs(); renderCards(); }
function duplicateRow(i){ rows.splice(i+1, 0, {...rows[i]}); saveConfig(rows); drawTable(); }
function removeRow(i){
  rows.splice(i, 1);
  saveConfig(rows);
  drawTable();
  const pages = uniquePages(rows);
  if(!pages.includes(currentPage)){
    if(pages.length){
      setCurrentPage(pages[0]);
    }else{
      currentPage = 'Setup';
      renderTabs();
      renderCards();
    }
  }else{
    renderTabs();
    renderCards();
  }
}
function seedExamples(){ rows = DEFAULTS.slice(); saveConfig(rows); drawTable(); renderTabs(); renderCards(); }
function exportConfig(){
  queueConfigSave.flush();
  const json = JSON.stringify(rows, null, 2);
  const blob = new Blob([json], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = el("a",{href:url, download:"n6hub-config.json"});
  document.body.append(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}
function importConfig(){ const input = el("input",{type:"file", accept:"application/json"}); input.onchange = async () => { const file = input.files[0]; if(!file) return; const text = await file.text(); try{ const next = JSON.parse(text); if(!Array.isArray(next)) throw new Error("Invalid format"); rows = next; saveConfig(rows); renderTabs(); renderCards(); if(dlg.open) drawTable(); }catch(e){ alert("Import failed: " + e.message); } }; input.click(); }
const mode = document.getElementById("mode");
(function initTheme(){ const saved = localStorage.getItem("n6hub:theme") || "dark"; document.documentElement.classList.toggle("light", saved==="light"); mode.checked = saved==="light"; })();
mode.onchange = () => { const light = mode.checked; document.documentElement.classList.toggle("light", light); localStorage.setItem("n6hub:theme", light ? "light" : "dark"); };
document.getElementById("btn-setup").onclick = openSetup;
document.getElementById("closeDlg").onclick = closeSetup;
document.getElementById("addRow").onclick = addRow;
document.getElementById("seed").onclick = seedExamples;
document.getElementById("save").onclick = () => {
  queueConfigSave.flush();
  saveConfig(rows);
  setStatus("Saved.");
};
document.getElementById("btn-export").onclick = exportConfig;
document.getElementById("btn-import").onclick = importConfig;
window.addEventListener('hashchange', () => {
  const page = getPageFromHash();
  if(!page || page === currentPage) return;
  const pages = uniquePages(rows);
  if(pages.includes(page)){
    setCurrentPage(page, {fromHash:true});
  }
});
window.addEventListener('beforeunload', () => {
  queueConfigSave.flush();
  saveNotesDebounced.flush();
});
renderTabs();
renderCards();
(function(d,s,id){
  // Load Tomorrow.io widget SDK once and invoke renderWidget when loaded
  if(d.getElementById(id)){
    if(window.__TOMORROW__){ window.__TOMORROW__.renderWidget(); }
    return;
  }
  const fjs=d.getElementsByTagName(s)[0];
  const js=d.createElement(s);
  js.id=id;
  js.src="https://www.tomorrow.io/v1/widget/sdk/sdk.bundle.min.js";
  js.onload=function(){
    if(window.__TOMORROW__){ window.__TOMORROW__.renderWidget(); }
  };
  fjs.parentNode.insertBefore(js,fjs);
})(document,'script','tomorrow-sdk');
</script>
</body>
</html>
